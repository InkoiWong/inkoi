## 图片懒加载

1. 问题：图片需求量大的页面加载性能低，影响用户体验
2. 思路：没出现在视野的图片先不加载，出现后才加载
3. 效果：提高客户端的加载速度，降低服务器的负载压力
4. 核心原理：监听滚动距离，对比图片位置
5. 实现方式：
  - a 图片src为空，用data-src储存信息
  - b 建立滚动监听：
    - 是否出现在可视窗口
    - 是否已加载
    - 进行加载（用data-src给src赋值）
  - c 初始化加载（首屏图片显示）

  ```js
  function isShowed($img){
    var st = $(window).scrollTop()
    var wt = $(window).height()
    var ot = $img.offset().top
    return ot > st && ot < (st + wt)
  }
  function isLoaded($img) {
    return $img.attr('src') === $img.attr('data-src')
  }
  function loading($img) {
    $img.attr('src',  $img.attr('data-src'))
  }
  function checkAllImg() {
    $('img').each(function () {
      isShowed($(this)) && !isLoaded($(this)) ? loading($(this)) : ''
    })
  }
  $(window).on('scroll', function () {
    checkAllImg()
  })
  checkAllImg()
  ```

## 图片预加载

1. 目的：提前加载图片，当用户需要查看时可从本地缓存中渲染
2. 效果：预加载会增加服务器的压力，可以说是牺牲服务器前端性能，换取更好的用户体验，这样可以是用户的操作得到最快的反应
3. 实现方式：
  - a 方式一：css

  ```css
    body:after{
      content: '';
      display: block;
      position: absolute;
      background:
        url() no-repeat -1000px -1000px,
        url() no-repeat -1000px -1000px,
        url() no-repeat -1000px -1000px;
      width: 0;
      height: 0;
    }
  ```

  - b 方式二：js
  ```js
    var imgSrcArr = [...]
    var imgWrap = []
    function preloadImg(arr) {
      imgSrcArr.map((item, i) => {
        imgWrap[i] = new Image()
        imgWrap[i].src = item
      })
    }
    $(function () { preloadImg(imgSrcArr) })
  ```

  - c 方式三：css + js
  ```css
  .preload-img:after{
    content: '';
    background:
        url() no-repeat -1000px -1000px,
        url() no-repeat -1000px -1000px,
        url() no-repeat -1000px -1000px;
  }
  ```
  ```js
  $(function(){
    $('target').addClass('preload-img')
  })
  ```

  - d 方式四：ajax
  ```js
  $(function(){
    $.get(url)
  })
  ```

## 综合使用

1. 优化思路一：
  - a 对图片建立不同尺寸的管理：原始、大、中、小、tiny
  - b