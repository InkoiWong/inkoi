## 浏览器缓存机制

(https://www.jianshu.com/p/54cc04190252)

缓存可以说是性能优化中简单高效的一种优化方式了。一个优秀的缓存策略可以缩短网页请求资源的距离，减少延迟，并且由于缓存文件可以重复利用，还可以减少带宽，降低网络负荷。

对于一个数据请求来说，可以分为发起网络请求、后端处理、浏览器响应三个步骤。浏览器缓存可以帮助我们在第一和第三步骤中优化性能。比如说直接使用缓存而不发起请求，或者发起了请求但后端存储的数据和前端一致，那么就没有必要再将数据回传回来，这样就减少了响应数据。

浏览器对于缓存的处理是根据`第一次请求`资源时返回的`响应头`来确定的。

- `强缓存`：
  不会向服务器发送请求，直接从缓存中读取资源，在 chrome 控制台的 Network 选项中可以看到该请求返回 200 的状态码，并且 Size 显示 from disk cache 或 from memory cache。
  强缓存可以通过设置两种 HTTP Header 实现：Expires 和 Cache-Control。
- `协商缓存`：
  协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程，有两种情况：
  协商缓存生效，返回 304 和 Not Modified
  协商缓存失效，返回 200 和请求结果
  协商缓存可以通过设置两种 HTTP Header 实现：Last-Modified 和 ETag 。

强缓存优先于协商缓存。
强缓存由保存在浏览器的值控制，协商缓存由服务器判断控制。

应用：
频繁变动的资源：Cache-Control: no-cache
不常变化的资源：Cache-Control: max-age=31536000（一年），然后为了解决更新问题，通常为增加版本号的方法，从而达到更改引用 URL 的目的，让之前的强制缓存失效 (其实并未立即失效，只是不再使用了而已)。

访问机制：
1 输入 url、标签：正常使用缓存策略
2 F5 刷新、右键刷新：设置 cache-control: max-age=0，强制走协商缓存
3 ctrl+F5 刷新：设置 cache-control: no-cache，强制获取最新的资源
